# osm-knife
In-memory geocoder based on osm.pbf data

План:
1) читаем нужный pbf проходясь по всем сущностям
2) применяем фильтр по тегам чтобы выбрать только те сущности которые нужны для геокодера
3) сохраняем id в отдельный файлик для дальнейшей обработки
4) последовательно обрабатываем каждую сущность по айдишнику, подтягивая зависимости
5) воссоздаем геометрию каждого нужного объекта, получаем geojson
6) геометрии всех объектов сохраняем в файл, для крупных применяем упрощение
7) геометрию переводим в набор токенов S2
8) получившийся набор токенов помещаем в структуру K-tree - это индекс для дальнейшего поиска
9) индекс сохраняем в файл, его же потом и загружаем в память чтобы работать в дальнейшем

Поиск:
1) по указанной точке получаем S2-токен нужного масштаба (например 20)
2) создаем цепочту токенов-родителей до уровня 1 чтобы использовать ее для поиска по дереву
3) производим поиск по каждому уровню от 1 до 19 в процессе поиска можем найти несколько совпадений
4) получаем id всех найденых объектов и по ним получаем информацию